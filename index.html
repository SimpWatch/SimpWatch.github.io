<head lang="en">
  <title>Simp Watch</title>
  <link rel="shortcut icon" href="icon.png">

  <link rel="stylesheet" href="simpwatch.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark">
    <div class="navbar-header">
      <a href="?"><!--suppress CheckImageSize --> <img src="icon-large.png" height="30" alt="Website icon"></a>
      <span class="navbar-links" id="nav-links"></span>
    </div>

    <!--suppress JSUnfilteredForInLoop -->
    <script>
      $.getJSON('simps.json', function(data) {
        let simps = data.simps
        let linksHtml = ""

        for(let index in simps) {
          linksHtml += `<a class="navbar-link" href="?simp=${simps[index]}">Simp ${simps[index]}</a>`
        }

        $("#nav-links").html(linksHtml)
      })
    </script>
  </nav>

  <!-- Page Content -->
  <div id="content" class="content text-center">
    <!-- Intro -->
    <div id="watch-a-simp">
      <h1> Watch the Simps </h1>
      <p>
        Check when those simps have been simping!
        <br>
        View live reports of simping activity, simp history, and a detailed analysis of known simps.
        <br>
        Choose a simp from the menu above to view report.
      </p>
    </div>

    <!-- Simp Not Found -->
    <div id="simp-not-found" style="display: none">
      <h1> Simp Not Found </h1>
      <p>
        There are no known simps by the name of <u id="simp-name-not-found"></u>!
      </p>
    </div>

    <!-- Simp Report -->
    <div id="simp-report" style="display: none">
      <h1><u id="simp-name"> Simp Name </u></h1>
      <h2><i id="simp-summary"> Summary of the simp. </i></h2>
    </div>
  </div>

  <script>
    let url = document.URL.split("?")

    function setupSimpReport(simp, report) {
      $("#simp-name").html(`Simp ${simp}`)
      $("#simp-summary").html(report.summary)
    }

    function handleSimpRequest(simp) {
      $.getJSON(`simps/${simp.toLowerCase()}.json`, function(data) {
        console.log(data)

        $("#watch-a-simp").hide()
        setupSimpReport(simp, data)
        $("#simp-report").show()
      }).fail(function () {
        $("#watch-a-simp").hide()
        $("#simp-not-found").show()
        $("#simp-name-not-found").html(simp)
      })
    }

    function getSimpFromUrl() {
      if(url.length === 2 && url[1].startsWith("simp=")) {
        let val = url[1].replace("simp=", "")
        return val.length > 0 ? val : null
      }

      return null
    }

    $(document).ready(function() {
      let simp = getSimpFromUrl();

      if(simp !== null) {
        console.log("Simp: " + simp)
        handleSimpRequest(simp)
      } else {
        console.log("No simp specified!")
      }
    });
  </script>
</body>
